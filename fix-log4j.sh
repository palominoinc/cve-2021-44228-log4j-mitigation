#!/bin/bash
# Tested on CentOS 7
# requires locate and updatedb installed, enough space on /tmp

echo 
echo "Backing up log4j libraries..."
for f in `locate log4j-core`
do 
  echo $f
  tar -rf /tmp/log4j-cores.tar $f
done

echo 
echo "Fixing..."
for f in `locate log4j-core`
do 
  echo $f
  zip -d $f org/apache/logging/log4j/core/lookup/JndiLookup.class
done

echo 
echo "Fixing tomcat properties..."
for f in `locate catalina.properties`
do 
  echo $f
  echo "log4j2.formatMsgNoLookups=true" >> $f
done

echo 
echo "Restarting tomcat..."
service tomcat restart
